{"version":3,"file":"sdk.js","sources":["../node_modules/detector/web/detector.js","../node_modules/detector/web/web-rules.js","../node_modules/detector/web/web-detector.js","../src/index.ts","../src/detector/EnvironmentDetector.ts","../src/metric/BaseMetric.ts","../src/metric/ChromeMetric.ts","../src/metric/FirefoxMetric.ts","../src/metric/OperaMetric.ts","../src/metric/SafariMetric.ts","../src/metric/MSEdgeMetric.ts","../src/metric/MSIEMetric.ts","../src/reporter/Reporter.ts","../src/reporter/PerformanceReporter.ts","../src/error/ErrorCatcher.ts","../src/reporter/BufferedReporter.ts","../src/reporter/ErrorReporter.ts"],"sourcesContent":["\"use strict\";\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar NA_VERSION = \"-1\";\nvar NA = {\n  name: \"na\",\n  version: NA_VERSION\n};\n\nfunction typeOf(type) {\n  return function (object) {\n    return Object.prototype.toString.call(object) === \"[object \" + type + \"]\";\n  };\n}\nvar isString = typeOf(\"String\");\nvar isRegExp = typeOf(\"RegExp\");\nvar isObject = typeOf(\"Object\");\nvar isFunction = typeOf(\"Function\");\n\nfunction each(object, factory) {\n  for (var i = 0, l = object.length; i < l; i++) {\n    if (factory.call(object, object[i], i) === false) {\n      break;\n    }\n  }\n}\n\n// UserAgent Detector.\n// @param {String} ua, userAgent.\n// @param {Object} expression\n// @return {Object}\n//    返回 null 表示当前表达式未匹配成功。\nfunction detect(name, expression, ua) {\n  var expr = isFunction(expression) ? expression.call(null, ua) : expression;\n  if (!expr) {\n    return null;\n  }\n  var info = {\n    name: name,\n    version: NA_VERSION,\n    codename: \"\"\n  };\n  if (expr === true) {\n    return info;\n  } else if (isString(expr)) {\n    if (ua.indexOf(expr) !== -1) {\n      return info;\n    }\n  } else if (isObject(expr)) {\n    if (expr.hasOwnProperty(\"version\")) {\n      info.version = expr.version;\n    }\n    return info;\n  } else if (isRegExp(expr)) {\n    var m = expr.exec(ua);\n    if (m) {\n      if (m.length >= 2 && m[1]) {\n        info.version = m[1].replace(/_/g, \".\");\n      } else {\n        info.version = NA_VERSION;\n      }\n      return info;\n    }\n  }\n}\n\n// 初始化识别。\nfunction init(ua, patterns, factory, detector) {\n  var detected = NA;\n  each(patterns, function (pattern) {\n    var d = detect(pattern[0], pattern[1], ua);\n    if (d) {\n      detected = d;\n      return false;\n    }\n  });\n  factory.call(detector, detected.name, detected.version);\n}\n\nvar Detector = function () {\n  function Detector(rules) {\n    _classCallCheck(this, Detector);\n\n    this._rules = rules;\n  }\n\n  // 解析 UserAgent 字符串\n  // @param {String} ua, userAgent string.\n  // @return {Object}\n\n\n  _createClass(Detector, [{\n    key: \"parse\",\n    value: function parse(ua) {\n      ua = (ua || \"\").toLowerCase();\n      var d = {};\n\n      init(ua, this._rules.device, function (name, version) {\n        var v = parseFloat(version);\n        d.device = {\n          name: name,\n          version: v,\n          fullVersion: version\n        };\n        d.device[name] = v;\n      }, d);\n\n      init(ua, this._rules.os, function (name, version) {\n        var v = parseFloat(version);\n        d.os = {\n          name: name,\n          version: v,\n          fullVersion: version\n        };\n        d.os[name] = v;\n      }, d);\n\n      var ieCore = this.IEMode(ua);\n\n      init(ua, this._rules.engine, function (name, version) {\n        var mode = version;\n        // IE 内核的浏览器，修复版本号及兼容模式。\n        if (ieCore) {\n          version = ieCore.engineVersion || ieCore.engineMode;\n          mode = ieCore.engineMode;\n        }\n        var v = parseFloat(version);\n        d.engine = {\n          name: name,\n          version: v,\n          fullVersion: version,\n          mode: parseFloat(mode),\n          fullMode: mode,\n          compatible: ieCore ? ieCore.compatible : false\n        };\n        d.engine[name] = v;\n      }, d);\n\n      init(ua, this._rules.browser, function (name, version) {\n        var mode = version;\n        // IE 内核的浏览器，修复浏览器版本及兼容模式。\n        if (ieCore) {\n          // 仅修改 IE 浏览器的版本，其他 IE 内核的版本不修改。\n          if (name === \"ie\") {\n            version = ieCore.browserVersion;\n          }\n          mode = ieCore.browserMode;\n        }\n        var v = parseFloat(version);\n        d.browser = {\n          name: name,\n          version: v,\n          fullVersion: version,\n          mode: parseFloat(mode),\n          fullMode: mode,\n          compatible: ieCore ? ieCore.compatible : false\n        };\n        d.browser[name] = v;\n      }, d);\n      return d;\n    }\n\n    // 解析使用 Trident 内核的浏览器的 `浏览器模式` 和 `文档模式` 信息。\n    // @param {String} ua, userAgent string.\n    // @return {Object}\n\n  }, {\n    key: \"IEMode\",\n    value: function IEMode(ua) {\n      if (!this._rules.re_msie.test(ua)) {\n        return null;\n      }\n\n      var m = void 0;\n      var engineMode = void 0;\n      var engineVersion = void 0;\n      var browserMode = void 0;\n      var browserVersion = void 0;\n\n      // IE8 及其以上提供有 Trident 信息，\n      // 默认的兼容模式，UA 中 Trident 版本不发生变化。\n      if (ua.indexOf(\"trident/\") !== -1) {\n        m = /\\btrident\\/([0-9.]+)/.exec(ua);\n        if (m && m.length >= 2) {\n          // 真实引擎版本。\n          engineVersion = m[1];\n          var v_version = m[1].split(\".\");\n          v_version[0] = parseInt(v_version[0], 10) + 4;\n          browserVersion = v_version.join(\".\");\n        }\n      }\n\n      m = this._rules.re_msie.exec(ua);\n      browserMode = m[1];\n      var v_mode = m[1].split(\".\");\n      if (typeof browserVersion === \"undefined\") {\n        browserVersion = browserMode;\n      }\n      v_mode[0] = parseInt(v_mode[0], 10) - 4;\n      engineMode = v_mode.join(\".\");\n      if (typeof engineVersion === \"undefined\") {\n        engineVersion = engineMode;\n      }\n\n      return {\n        browserVersion: browserVersion,\n        browserMode: browserMode,\n        engineVersion: engineVersion,\n        engineMode: engineMode,\n        compatible: engineVersion !== engineMode\n      };\n    }\n  }]);\n\n  return Detector;\n}();\n\nmodule.exports = Detector;","\"use strict\";\n\nvar win = typeof window === \"undefined\" ? global : window;\nvar external = win.external;\nvar re_msie = /\\b(?:msie |ie |trident\\/[0-9].*rv[ :])([0-9.]+)/;\nvar re_blackberry_10 = /\\bbb10\\b.+?\\bversion\\/([\\d.]+)/;\nvar re_blackberry_6_7 = /\\bblackberry\\b.+\\bversion\\/([\\d.]+)/;\nvar re_blackberry_4_5 = /\\bblackberry\\d+\\/([\\d.]+)/;\n\nvar NA_VERSION = \"-1\";\n\n// 硬件设备信息识别表达式。\n// 使用数组可以按优先级排序。\nvar DEVICES = [[\"nokia\", function (ua) {\n  // 不能将两个表达式合并，因为可能出现 \"nokia; nokia 960\"\n  // 这种情况下会优先识别出 nokia/-1\n  if (ua.indexOf(\"nokia \") !== -1) {\n    return (/\\bnokia ([0-9]+)?/\n    );\n  } else {\n    return (/\\bnokia([a-z0-9]+)?/\n    );\n  }\n}],\n// 三星有 Android 和 WP 设备。\n[\"samsung\", function (ua) {\n  if (ua.indexOf(\"samsung\") !== -1) {\n    return (/\\bsamsung(?:[ \\-](?:sgh|gt|sm))?-([a-z0-9]+)/\n    );\n  } else {\n    return (/\\b(?:sgh|sch|gt|sm)-([a-z0-9]+)/\n    );\n  }\n}], [\"wp\", function (ua) {\n  return ua.indexOf(\"windows phone \") !== -1 || ua.indexOf(\"xblwp\") !== -1 || ua.indexOf(\"zunewp\") !== -1 || ua.indexOf(\"windows ce\") !== -1;\n}], [\"pc\", \"windows\"], [\"ipad\", \"ipad\"],\n// ipod 规则应置于 iphone 之前。\n[\"ipod\", \"ipod\"], [\"iphone\", /\\biphone\\b|\\biph(\\d)/], [\"mac\", \"macintosh\"],\n// 小米\n[\"mi\", /\\bmi[ \\-]?([a-z0-9 ]+(?= build|\\)))/],\n// 红米\n[\"hongmi\", /\\bhm[ \\-]?([a-z0-9]+)/], [\"aliyun\", /\\baliyunos\\b(?:[\\-](\\d+))?/], [\"meizu\", function (ua) {\n  return ua.indexOf(\"meizu\") >= 0 ? /\\bmeizu[\\/ ]([a-z0-9]+)\\b/ : /\\bm([0-9cx]{1,4})\\b/;\n}], [\"nexus\", /\\bnexus ([0-9s.]+)/], [\"huawei\", function (ua) {\n  var re_mediapad = /\\bmediapad (.+?)(?= build\\/huaweimediapad\\b)/;\n  if (ua.indexOf(\"huawei-huawei\") !== -1) {\n    return (/\\bhuawei\\-huawei\\-([a-z0-9\\-]+)/\n    );\n  } else if (re_mediapad.test(ua)) {\n    return re_mediapad;\n  } else {\n    return (/\\bhuawei[ _\\-]?([a-z0-9]+)/\n    );\n  }\n}], [\"lenovo\", function (ua) {\n  if (ua.indexOf(\"lenovo-lenovo\") !== -1) {\n    return (/\\blenovo\\-lenovo[ \\-]([a-z0-9]+)/\n    );\n  } else {\n    return (/\\blenovo[ \\-]?([a-z0-9]+)/\n    );\n  }\n}],\n// 中兴\n[\"zte\", function (ua) {\n  if (/\\bzte\\-[tu]/.test(ua)) {\n    return (/\\bzte-[tu][ _\\-]?([a-su-z0-9\\+]+)/\n    );\n  } else {\n    return (/\\bzte[ _\\-]?([a-su-z0-9\\+]+)/\n    );\n  }\n}],\n// 步步高\n[\"vivo\", /\\bvivo(?: ([a-z0-9]+))?/], [\"htc\", function (ua) {\n  if (/\\bhtc[a-z0-9 _\\-]+(?= build\\b)/.test(ua)) {\n    return (/\\bhtc[ _\\-]?([a-z0-9 ]+(?= build))/\n    );\n  } else {\n    return (/\\bhtc[ _\\-]?([a-z0-9 ]+)/\n    );\n  }\n}], [\"oppo\", /\\boppo[_]([a-z0-9]+)/], [\"konka\", /\\bkonka[_\\-]([a-z0-9]+)/], [\"sonyericsson\", /\\bmt([a-z0-9]+)/], [\"coolpad\", /\\bcoolpad[_ ]?([a-z0-9]+)/], [\"lg\", /\\blg[\\-]([a-z0-9]+)/], [\"android\", /\\bandroid\\b|\\badr\\b/], [\"blackberry\", function (ua) {\n  if (ua.indexOf(\"blackberry\") >= 0) {\n    return (/\\bblackberry\\s?(\\d+)/\n    );\n  }\n  return \"bb10\";\n}]];\n\n// 操作系统信息识别表达式\nvar OS = [[\"wp\", function (ua) {\n  if (ua.indexOf(\"windows phone \") !== -1) {\n    return (/\\bwindows phone (?:os )?([0-9.]+)/\n    );\n  } else if (ua.indexOf(\"xblwp\") !== -1) {\n    return (/\\bxblwp([0-9.]+)/\n    );\n  } else if (ua.indexOf(\"zunewp\") !== -1) {\n    return (/\\bzunewp([0-9.]+)/\n    );\n  }\n  return \"windows phone\";\n}], [\"windows\", /\\bwindows nt ([0-9.]+)/], [\"macosx\", /\\bmac os x ([0-9._]+)/], [\"ios\", function (ua) {\n  if (/\\bcpu(?: iphone)? os /.test(ua)) {\n    return (/\\bcpu(?: iphone)? os ([0-9._]+)/\n    );\n  } else if (ua.indexOf(\"iph os \") !== -1) {\n    return (/\\biph os ([0-9_]+)/\n    );\n  } else {\n    return (/\\bios\\b/\n    );\n  }\n}], [\"yunos\", /\\baliyunos ([0-9.]+)/], [\"android\", function (ua) {\n  if (ua.indexOf(\"android\") >= 0) {\n    return (/\\bandroid[ \\/-]?([0-9.x]+)?/\n    );\n  } else if (ua.indexOf(\"adr\") >= 0) {\n    if (ua.indexOf(\"mqqbrowser\") >= 0) {\n      return (/\\badr[ ]\\(linux; u; ([0-9.]+)?/\n      );\n    } else {\n      return (/\\badr(?:[ ]([0-9.]+))?/\n      );\n    }\n  }\n  return \"android\";\n  //return /\\b(?:android|\\badr)(?:[\\/\\- ](?:\\(linux; u; )?)?([0-9.x]+)?/;\n}], [\"chromeos\", /\\bcros i686 ([0-9.]+)/], [\"linux\", \"linux\"], [\"windowsce\", /\\bwindows ce(?: ([0-9.]+))?/], [\"symbian\", /\\bsymbian(?:os)?\\/([0-9.]+)/], [\"blackberry\", function (ua) {\n  var m = ua.match(re_blackberry_10) || ua.match(re_blackberry_6_7) || ua.match(re_blackberry_4_5);\n  return m ? { version: m[1] } : \"blackberry\";\n}]];\n\n// 针对同源的 TheWorld 和 360 的 external 对象进行检测。\n// @param {String} key, 关键字，用于检测浏览器的安装路径中出现的关键字。\n// @return {Undefined,Boolean,Object} 返回 undefined 或 false 表示检测未命中。\nfunction checkTW360External(key) {\n  if (!external) {\n    return;\n  } // return undefined.\n  try {\n    //        360安装路径：\n    //        C:%5CPROGRA~1%5C360%5C360se3%5C360SE.exe\n    var runpath = external.twGetRunPath.toLowerCase();\n    // 360SE 3.x ~ 5.x support.\n    // 暴露的 external.twGetVersion 和 external.twGetSecurityID 均为 undefined。\n    // 因此只能用 try/catch 而无法使用特性判断。\n    var security = external.twGetSecurityID(win);\n    var version = external.twGetVersion(security);\n\n    if (runpath && runpath.indexOf(key) === -1) {\n      return false;\n    }\n    if (version) {\n      return { version: version };\n    }\n  } catch (ex) {/* */}\n}\n\nvar ENGINE = [[\"edgehtml\", /edge\\/([0-9.]+)/], [\"trident\", re_msie], [\"blink\", function () {\n  return \"chrome\" in win && \"CSS\" in win && /\\bapplewebkit[\\/]?([0-9.+]+)/;\n}], [\"webkit\", /\\bapplewebkit[\\/]?([0-9.+]+)/], [\"gecko\", function (ua) {\n  var match = ua.match(/\\brv:([\\d\\w.]+).*\\bgecko\\/(\\d+)/);\n  if (match) {\n    return {\n      version: match[1] + \".\" + match[2]\n    };\n  }\n}], [\"presto\", /\\bpresto\\/([0-9.]+)/], [\"androidwebkit\", /\\bandroidwebkit\\/([0-9.]+)/], [\"coolpadwebkit\", /\\bcoolpadwebkit\\/([0-9.]+)/], [\"u2\", /\\bu2\\/([0-9.]+)/], [\"u3\", /\\bu3\\/([0-9.]+)/]];\nvar BROWSER = [\n// Microsoft Edge Browser, Default browser in Windows 10.\n[\"edge\", /edge\\/([0-9.]+)/],\n// Sogou.\n[\"sogou\", function (ua) {\n  if (ua.indexOf(\"sogoumobilebrowser\") >= 0) {\n    return (/sogoumobilebrowser\\/([0-9.]+)/\n    );\n  } else if (ua.indexOf(\"sogoumse\") >= 0) {\n    return true;\n  }\n  return (/ se ([0-9.x]+)/\n  );\n}],\n// TheWorld (世界之窗)\n// 由于裙带关系，TheWorld API 与 360 高度重合。\n// 只能通过 UA 和程序安装路径中的应用程序名来区分。\n// TheWorld 的 UA 比 360 更靠谱，所有将 TheWorld 的规则放置到 360 之前。\n[\"theworld\", function () {\n  var x = checkTW360External(\"theworld\");\n  if (typeof x !== \"undefined\") {\n    return x;\n  }\n  return (/theworld(?: ([\\d.])+)?/\n  );\n}],\n// 360SE, 360EE.\n[\"360\", function (ua) {\n  var x = checkTW360External(\"360se\");\n  if (typeof x !== \"undefined\") {\n    return x;\n  }\n  if (ua.indexOf(\"360 aphone browser\") !== -1) {\n    return (/\\b360 aphone browser \\(([^\\)]+)\\)/\n    );\n  }\n  return (/\\b360(?:se|ee|chrome|browser)\\b/\n  );\n}],\n// Maxthon\n[\"maxthon\", function () {\n  try {\n    if (external && (external.mxVersion || external.max_version)) {\n      return {\n        version: external.mxVersion || external.max_version\n      };\n    }\n  } catch (ex) {/* */}\n  return (/\\b(?:maxthon|mxbrowser)(?:[ \\/]([0-9.]+))?/\n  );\n}], [\"micromessenger\", /\\bmicromessenger\\/([\\d.]+)/], [\"qq\", /\\bm?qqbrowser\\/([0-9.]+)/], [\"green\", \"greenbrowser\"], [\"tt\", /\\btencenttraveler ([0-9.]+)/], [\"liebao\", function (ua) {\n  if (ua.indexOf(\"liebaofast\") >= 0) {\n    return (/\\bliebaofast\\/([0-9.]+)/\n    );\n  }\n  if (ua.indexOf(\"lbbrowser\") === -1) {\n    return false;\n  }\n  var version = void 0;\n  try {\n    if (external && external.LiebaoGetVersion) {\n      version = external.LiebaoGetVersion();\n    }\n  } catch (ex) {/* */}\n  return {\n    version: version || NA_VERSION\n  };\n}], [\"tao\", /\\btaobrowser\\/([0-9.]+)/], [\"coolnovo\", /\\bcoolnovo\\/([0-9.]+)/], [\"saayaa\", \"saayaa\"],\n// 有基于 Chromniun 的急速模式和基于 IE 的兼容模式。必须在 IE 的规则之前。\n[\"baidu\", /\\b(?:ba?idubrowser|baiduhd)[ \\/]([0-9.x]+)/],\n// 后面会做修复版本号，这里只要能识别是 IE 即可。\n[\"ie\", re_msie], [\"mi\", /\\bmiuibrowser\\/([0-9.]+)/],\n// Opera 15 之后开始使用 Chromniun 内核，需要放在 Chrome 的规则之前。\n[\"opera\", function (ua) {\n  var re_opera_old = /\\bopera.+version\\/([0-9.ab]+)/;\n  var re_opera_new = /\\bopr\\/([0-9.]+)/;\n  return re_opera_old.test(ua) ? re_opera_old : re_opera_new;\n}], [\"oupeng\", /\\boupeng\\/([0-9.]+)/], [\"yandex\", /yabrowser\\/([0-9.]+)/],\n// 支付宝手机客户端\n[\"ali-ap\", function (ua) {\n  if (ua.indexOf(\"aliapp\") > 0) {\n    return (/\\baliapp\\(ap\\/([0-9.]+)\\)/\n    );\n  } else {\n    return (/\\balipayclient\\/([0-9.]+)\\b/\n    );\n  }\n}],\n// 支付宝平板客户端\n[\"ali-ap-pd\", /\\baliapp\\(ap-pd\\/([0-9.]+)\\)/],\n// 支付宝商户客户端\n[\"ali-am\", /\\baliapp\\(am\\/([0-9.]+)\\)/],\n// 淘宝手机客户端\n[\"ali-tb\", /\\baliapp\\(tb\\/([0-9.]+)\\)/],\n// 淘宝平板客户端\n[\"ali-tb-pd\", /\\baliapp\\(tb-pd\\/([0-9.]+)\\)/],\n// 天猫手机客户端\n[\"ali-tm\", /\\baliapp\\(tm\\/([0-9.]+)\\)/],\n// 天猫平板客户端\n[\"ali-tm-pd\", /\\baliapp\\(tm-pd\\/([0-9.]+)\\)/],\n// UC 浏览器，可能会被识别为 Android 浏览器，规则需要前置。\n// UC 桌面版浏览器携带 Chrome 信息，需要放在 Chrome 之前。\n[\"uc\", function (ua) {\n  if (ua.indexOf(\"ucbrowser/\") >= 0) {\n    return (/\\bucbrowser\\/([0-9.]+)/\n    );\n  } else if (ua.indexOf(\"ubrowser/\") >= 0) {\n    return (/\\bubrowser\\/([0-9.]+)/\n    );\n  } else if (/\\buc\\/[0-9]/.test(ua)) {\n    return (/\\buc\\/([0-9.]+)/\n    );\n  } else if (ua.indexOf(\"ucweb\") >= 0) {\n    // `ucweb/2.0` is compony info.\n    // `UCWEB8.7.2.214/145/800` is browser info.\n    return (/\\bucweb([0-9.]+)?/\n    );\n  } else {\n    return (/\\b(?:ucbrowser|uc)\\b/\n    );\n  }\n}], [\"chrome\", / (?:chrome|crios|crmo)\\/([0-9.]+)/],\n// Android 默认浏览器。该规则需要在 safari 之前。\n[\"android\", function (ua) {\n  if (ua.indexOf(\"android\") === -1) {\n    return;\n  }\n  return (/\\bversion\\/([0-9.]+(?: beta)?)/\n  );\n}], [\"blackberry\", function (ua) {\n  var m = ua.match(re_blackberry_10) || ua.match(re_blackberry_6_7) || ua.match(re_blackberry_4_5);\n  return m ? { version: m[1] } : \"blackberry\";\n}], [\"safari\", /\\bversion\\/([0-9.]+(?: beta)?)(?: mobile(?:\\/[a-z0-9]+)?)? safari\\//],\n// 如果不能被识别为 Safari，则猜测是 WebView。\n[\"webview\", /\\bcpu(?: iphone)? os (?:[0-9._]+).+\\bapplewebkit\\b/], [\"firefox\", /\\bfirefox\\/([0-9.ab]+)/], [\"nokia\", /\\bnokiabrowser\\/([0-9.]+)/]];\n\nmodule.exports = {\n  device: DEVICES,\n  os: OS,\n  browser: BROWSER,\n  engine: ENGINE,\n  re_msie: re_msie\n};","\"use strict\";\n\nvar Detector = require(\"./detector\");\nvar WebRules = require(\"./web-rules\");\n\nvar userAgent = navigator.userAgent || \"\";\n//const platform = navigator.platform || \"\";\nvar appVersion = navigator.appVersion || \"\";\nvar vendor = navigator.vendor || \"\";\nvar ua = userAgent + \" \" + appVersion + \" \" + vendor;\n\nvar detector = new Detector(WebRules);\n\n// 解析使用 Trident 内核的浏览器的 `浏览器模式` 和 `文档模式` 信息。\n// @param {String} ua, userAgent string.\n// @return {Object}\nfunction IEMode(ua) {\n  if (!WebRules.re_msie.test(ua)) {\n    return null;\n  }\n\n  var m = void 0;\n  var engineMode = void 0;\n  var engineVersion = void 0;\n  var browserMode = void 0;\n  var browserVersion = void 0;\n\n  // IE8 及其以上提供有 Trident 信息，\n  // 默认的兼容模式，UA 中 Trident 版本不发生变化。\n  if (ua.indexOf(\"trident/\") !== -1) {\n    m = /\\btrident\\/([0-9.]+)/.exec(ua);\n    if (m && m.length >= 2) {\n      // 真实引擎版本。\n      engineVersion = m[1];\n      var v_version = m[1].split(\".\");\n      v_version[0] = parseInt(v_version[0], 10) + 4;\n      browserVersion = v_version.join(\".\");\n    }\n  }\n\n  m = WebRules.re_msie.exec(ua);\n  browserMode = m[1];\n  var v_mode = m[1].split(\".\");\n  if (typeof browserVersion === \"undefined\") {\n    browserVersion = browserMode;\n  }\n  v_mode[0] = parseInt(v_mode[0], 10) - 4;\n  engineMode = v_mode.join(\".\");\n  if (typeof engineVersion === \"undefined\") {\n    engineVersion = engineMode;\n  }\n\n  return {\n    browserVersion: browserVersion,\n    browserMode: browserMode,\n    engineVersion: engineVersion,\n    engineMode: engineMode,\n    compatible: engineVersion !== engineMode\n  };\n}\n\nfunction WebParse(ua) {\n  var d = detector.parse(ua);\n\n  var ieCore = IEMode(ua);\n\n  // IE 内核的浏览器，修复版本号及兼容模式。\n  if (ieCore) {\n    var engineName = d.engine.name;\n    var engineVersion = ieCore.engineVersion || ieCore.engineMode;\n    var ve = parseFloat(engineVersion);\n    var engineMode = ieCore.engineMode;\n\n    d.engine = {\n      name: engineName,\n      version: ve,\n      fullVersion: engineVersion,\n      mode: parseFloat(engineMode),\n      fullMode: engineMode,\n      compatible: ieCore ? ieCore.compatible : false\n    };\n    d.engine[d.engine.name] = ve;\n\n    var browserName = d.browser.name;\n    // IE 内核的浏览器，修复浏览器版本及兼容模式。\n    // 仅修改 IE 浏览器的版本，其他 IE 内核的版本不修改。\n    var browserVersion = d.browser.fullVersion;\n    if (browserName === \"ie\") {\n      browserVersion = ieCore.browserVersion;\n    }\n    var browserMode = ieCore.browserMode;\n    var vb = parseFloat(browserVersion);\n    d.browser = {\n      name: browserName,\n      version: vb,\n      fullVersion: browserVersion,\n      mode: parseFloat(browserMode),\n      fullMode: browserMode,\n      compatible: ieCore ? ieCore.compatible : false\n    };\n    d.browser[browserName] = vb;\n  }\n  return d;\n}\n\nvar Tan = WebParse(ua);\nTan.parse = WebParse;\nmodule.exports = Tan;","import { BrowserType, Environment } from './detector/EnvironmentDetector';\nimport { BaseMetric } from './metric/BaseMetric';\nimport ChromeMetric from './metric/ChromeMetric';\nimport FirefoxMetric from './metric/FirefoxMetric';\nimport OperaMetric from './metric/OperaMetric';\nimport SafariMetric from './metric/SafariMetric';\nimport MSEdgeMetric from './metric/MSEdgeMetric';\nimport MSIEMetric from './metric/MSIEMetric';\nimport PerformanceReporter from './reporter/PerformanceReporter';\nimport ErrorCatcher from './error/ErrorCatcher';\nimport ErrorReporter from './reporter/ErrorReporter';\n\nexport * from './detector/EnvironmentDetector';\n\nconst _window: any = window;\n\nif (__DEV__) {\n  /**\n   * Basic configuration should retrived from\n   * server via Webtracker sdk.js file\n   */\n  _window.WEB_TRACKER = {\n    token: 'token_string',\n    metric: {\n      enabled: true\n    },\n    catcher: {\n      enabled: true,\n      random: 1,    // 0-1\n      repeat: 5,    // allow erorr repeat\n      merge: true,    // merge errors\n      delay: 1000,    // batch report\n      exclude: [/^Script error.?/i]    // support regex\n    }\n  };\n}\n\nif (!_window.WEB_TRACKER) {\n  throw new Error('No configuration for Web Tracker is found');\n}\n\n// Catch configuration file from global context\nconst config: any = _window.WEB_TRACKER;\nconst token = config.token;\nlet metricStrategy: BaseMetric;\nconst environment = new Environment().detect();\n\nfunction metricMeasuringStrategy() {\n  LOG('Current Browser:',\n    environment.browser._type, environment.browser.version);\n  switch (environment.browser.type) {\n    case BrowserType.Chrome:\n      metricStrategy = new ChromeMetric();\n      break;\n    case BrowserType.Firefox:\n      metricStrategy = new FirefoxMetric();\n      break;\n    case BrowserType.Opera:\n      metricStrategy = new OperaMetric();\n      break;\n    case BrowserType.Safari:\n      metricStrategy = new SafariMetric();\n      break;\n    case BrowserType.MS_Edge:\n      metricStrategy = new MSEdgeMetric();\n      break;\n    case BrowserType.MSIE:\n      metricStrategy = new MSIEMetric();\n      break;\n    default:\n      // Meet unexpected browser,\n      // use basic measurement strategy.\n      metricStrategy = new BaseMetric();\n      break;\n  }\n\n  const totalLoadingTime = metricStrategy.computeTotalLoadingTime();\n  metricStrategy.measure();\n\n  // Incorrect total loading time,\n  // which means it's measured prematurely.\n  if (totalLoadingTime <= 0) {\n    LOG('Measured prematurely, retrying');\n    metricMeasuringStrategy();\n    return;\n  }\n\n  LOG('\\n============ PERFORMANCE METRIC START ============');\n  LOG('DNSLookupTime:', metricStrategy.DNSLookupTime);\n  LOG('Total Loading Time:', totalLoadingTime);\n  LOG('First Byte Time:', metricStrategy.firstByteTime);\n  LOG('First Paint Time', metricStrategy.firstPaintTime);\n  LOG('First Intercation Time', metricStrategy.firstInteractionTime);\n  LOG('Resource Time:', JSON.stringify(metricStrategy.computeResourceTime()));\n  LOG('Total Downloding Time:', metricStrategy.downloadingTime);\n  LOG('DOM Parsing Time:', metricStrategy.DOMParsingTime);\n\n  const reporter = new PerformanceReporter(token, environment);\n  const report = reporter.report(metricStrategy);\n  if (__DEV__) {\n    report.then(() => {\n      LOG('============ PERFORMANCE METRIC END ============\\n\\n');\n    });\n  }\n  report.catch(() => {\n    LOG('Failed to report performance metrics');\n  });\n}\n\nfunction installErrorCatcher() {\n  const reporter = new ErrorReporter(token, environment);\n  new ErrorCatcher(reporter).install();\n\n  if (__DEV__) {\n    setTimeout(() => {\n      throw new TypeError('Async error occurs');\n    }, 100);\n    setTimeout(() => {\n      throw new TypeError('Async error occurs');\n    }, 200);\n    setTimeout(() => {\n      throw new TypeError('Async error occurs');\n    }, 300);\n    setTimeout(() => {\n      throw new TypeError('Async error occurs');\n    }, 400);\n    throw new Error('Sync error occurs');\n  }\n}\n\n// Start measuring after page loaded completely\nwindow.addEventListener('load', () => {\n  if (config.metric.enabled) {\n    setTimeout(() => metricMeasuringStrategy());\n  }\n  // Catcher starts after performance metric,\n  // So that metric report process won't be stopped\n  if (config.catcher.enabled) {\n    installErrorCatcher();\n  }\n});","import detector from 'detector';\n\n/**\n * Detector Field.\n */\ninterface DetectorField {\n  name: string;\n  version: string;\n  fullVersion: string;\n}\n\n/**\n * 3rd party detector wrapper.\n */\nclass Detector {\n  constructor(\n    public device: DetectorField,\n    public os: DetectorField,\n    public engine: DetectorField,\n    public browser: DetectorField\n  ) {}\n}\n\n/**\n * Instantiate detector.\n */\nconst _detector: Detector = new Detector(\n  detector.device,\n  detector.os,\n  detector.engine,\n  detector.browser\n);\n\nLOG('detector:', _detector);\n\nexport enum BrowserType {\n  MSIE,\n  MS_Edge,\n  Chrome,\n  Safari,\n  Firefox,\n  Opera\n}\n\nexport enum OSType {\n  Windows,\n  MacOS,\n  IOS,\n  Android,\n  ChromeOS,\n  Linux,\n  WindowsPhone,\n  YunOS\n}\n\nexport enum EngineType {\n  EdgeHTML,       // Microsoft Edge\n  Trident,        // Microsoft Trident\n  Blink,          // Google Blink\n  Webkit,         // Apple Webkit\n  Gecko,          // Mozilla Gecko\n  Presto,         // Opera Presto\n  AndroidWebkit,  // Android Webkit\n  UC,             // UC rendering Engine\n}\n\nexport class Browser {\n  public _type: string;\n  constructor(\n    public type: BrowserType,\n    public version: string\n  ) {\n    this._type = BrowserType[type];\n  }\n}\n\nexport class Engine {\n  public _type: string;\n  constructor(\n    public type: EngineType,\n    public version: string\n  ) {\n    this._type = EngineType[type];\n  }\n}\n\nexport class OperatingSystem {\n  public _type: string;\n  constructor(\n    public type: OSType,\n    public version: string\n  ) {\n    this._type = OSType[type];\n  }\n}\n\nexport class Device {\n  constructor(\n    public type: string,\n    public version: string\n  ) {}\n}\n\n/**\n * Represents for Environment of Brower.\n * It's an singleton instance.\n */\nexport class Environment {\n  public browser: Browser;\n  public device: Device;\n  public engine: Engine;\n  public operatingSystem: OperatingSystem;\n\n  // No way to get these two in Browser\n  public IPAddress: string;\n  public network: string;\n\n  /**\n   * Detects the environment of target browser.\n   * Like type, version, network, etc.\n   * @return {Environment}\n   */\n  public detect(): Environment {\n    // Detect browser status\n    this.detectBrowser();\n    this.detectEngine();\n    this.detectOperatingSystem();\n    this.detectDevice();\n    return this;\n  }\n\n  /**\n   * Detect browser infomation by detector.\n   */\n  private detectBrowser() {\n    let browser: BrowserType = BrowserType.Chrome;\n    const version: string = _detector.browser.fullVersion;\n    switch (_detector.browser.name) {\n      case 'chrome':\n        browser = BrowserType.Chrome;\n        break;\n      case 'firefox':\n        browser = BrowserType.Firefox;\n        break;\n      case 'safari':\n        browser = BrowserType.Safari;\n        break;\n      case 'opera':\n        browser = BrowserType.Opera;\n        break;\n      case 'ie':\n        browser = BrowserType.MSIE;\n        break;\n      case 'edge':\n        browser = BrowserType.MS_Edge;\n        break;\n      default: break;\n    }\n    this.browser = new Browser(browser, version);\n  }\n\n  private detectEngine() {\n    let engine: EngineType = EngineType.Webkit;\n    const version: string = _detector.engine.fullVersion;\n    switch (_detector.engine.name) {\n      case 'edgehtml':\n        engine = EngineType.EdgeHTML;\n        break;\n      case 'trident':\n        engine = EngineType.Trident;\n        break;\n      case 'blink':\n        engine = EngineType.Blink;\n        break;\n      case 'webkit':\n        engine = EngineType.Webkit;\n        break;\n      case 'gecko':\n        engine = EngineType.Gecko;\n        break;\n      case 'presto':\n        engine = EngineType.Presto;\n        break;\n      case 'androidwebkit':\n        engine = EngineType.AndroidWebkit;\n        break;\n      case 'u2': case 'u3':\n        engine = EngineType.UC;\n        break;\n      default: break;\n    }\n    this.engine = new Engine(engine, version);\n  }\n\n  private detectOperatingSystem() {\n    let operatingSystem: OSType = OSType.MacOS;\n    const version: string = _detector.browser.fullVersion;\n    switch (_detector.os.name) {\n      case 'window':\n        operatingSystem = OSType.Windows;\n        break;\n      case 'macosx':\n        operatingSystem = OSType.MacOS;\n        break;\n      case 'ios':\n        operatingSystem = OSType.IOS;\n        break;\n      case 'android':\n        operatingSystem = OSType.Android;\n        break;\n      case 'chromeos':\n        operatingSystem = OSType.ChromeOS;\n        break;\n      case 'linux':\n        operatingSystem = OSType.Linux;\n        break;\n      case 'wp':\n        operatingSystem = OSType.WindowsPhone;\n        break;\n      case 'yunos':\n        operatingSystem = OSType.YunOS;\n        break;\n      default: break;\n    }\n    this.operatingSystem = new OperatingSystem(operatingSystem, version);\n  }\n\n  private detectDevice() {\n    this.device = new Device(_detector.device.name, _detector.device.fullVersion);\n  }\n}\n","/**\n * Records time to download resources.\n */\nexport class ResourceTime {\n  public img: number;\n  public script: number;\n  public link: number;\n}\n\n/**\n * Metric mesuaring methods.\n */\nexport interface Measurable {\n  // Time to first paint\n  computeFirstPaintTime(): number;\n  // Time to show above the fold\n  computeFirstMeaningfulTime(): number;\n  // Time to first interaction\n  computeFirstInteractionTime(): number;\n  // Total loading time\n  computeTotalLoadingTime(): number;\n  // Total page downloading time\n  computeTotalDownloadingTime(): number;\n  // Time to load resources\n  computeResourceTime(): ResourceTime;\n  // Time to parse DOM tree\n  computeDOMParsingTime(): number;\n  // Time to look up DNS\n  computeDNSLookupTime(): number;\n  // Time to first byte\n  computeFirstByteTime(): number;\n}\n\nexport class Metric {\n  firstPaintTime: number;\n  firstMeaningfulTime: number;\n  firstInteractionTime: number;\n  totalLoadingTime: number;\n  downloadingTime: number;\n  DOMParsingTime: number;\n  DNSLookupTime: number;\n  firstByteTime: number;\n  // Resources time\n  imagesTime: number;\n  stylesTime: number;\n  scriptsTime: number;\n}\n\n/**\n * Base performance metric measurement.\n * Implements Navigation Timing API and Resource Timing API,\n * which are W3C standards. Otherwise implements polyfill for most of the browsers.\n *\n * Compatibility\n * http://caniuse.com/#feat=nav-timing\n */\nexport class BaseMetric extends Metric implements Measurable {\n  private timing: PerformanceTiming;\n  private performanceAPI: Performance;\n\n  constructor() {\n    super();\n    this.performanceAPI = window.performance;\n    if (this.performanceAPI) {\n      this.timing = this.performanceAPI.timing;\n    }\n  }\n\n  /**\n   * Perform mesauring works.\n   */\n  public measure() {\n    const resourcesTime = this.computeResourceTime();\n    this.imagesTime = resourcesTime.img;\n    this.stylesTime = resourcesTime.link;\n    this.scriptsTime = resourcesTime.script;\n    this.DNSLookupTime = this.computeDNSLookupTime();\n    this.DOMParsingTime = this.computeDOMParsingTime();\n    this.firstByteTime = this.computeFirstByteTime();\n    this.firstInteractionTime = this.computeFirstInteractionTime();\n    this.firstMeaningfulTime = this.computeFirstMeaningfulTime();\n    this.firstPaintTime = this.computeFirstPaintTime();\n    this.downloadingTime = this.computeTotalDownloadingTime();\n    this.totalLoadingTime = this.computeTotalLoadingTime();\n    return this;\n  }\n\n  /**\n   * Polyfill for measuring first paint time.\n   * The strategy is to use Timing API.\n   * Compatibility: IE9+\n   * @return {number}\n   */\n  public computeFirstPaintTime(): number {\n    if (!this.timing) return -1;\n    const firstPaintTime = Math.round(this.timing.domLoading - this.timing.navigationStart);\n    return firstPaintTime <= 0 ? -1 : firstPaintTime;\n  }\n\n  public computeFirstMeaningfulTime(): number {\n    return -1;\n  }\n\n  /**\n   * Time to interact with DOM.\n   * Measuring DOMReady time.\n   * @return {number}\n   */\n  public computeFirstInteractionTime(): number {\n    if (!this.timing) return -1;\n    const interactionTime = Math.round(this.timing.domInteractive - this.timing.navigationStart);\n    return interactionTime <= 0 ? -1 : interactionTime;\n  }\n\n  /**\n   * All resources loading time.\n   * Measuring onload time.\n   * @return {number}\n   */\n  public computeTotalLoadingTime(): number {\n    if (!this.timing) return -1;\n    const loadingTime = Math.round(this.timing.loadEventEnd - this.timing.navigationStart);\n    return loadingTime <= 0 ? -1 : loadingTime;\n  }\n\n  /**\n   * Time to download all resources.\n   * @return {number}\n   */\n  public computeTotalDownloadingTime(): number {\n    if (!this.timing) return -1;\n    const pageDownloadingTime = Math.round(this.timing.responseEnd - this.timing.requestStart);\n    return pageDownloadingTime <= 0 ? -1 : pageDownloadingTime;\n  }\n\n  /**\n   * Computes resources loading time.\n   * Calculate the average time of each resource type.\n   * Compatibility: IE10+\n   * @return {ResourceTime}\n   */\n  public computeResourceTime(): ResourceTime {\n    const resourcesTime = new ResourceTime();\n    if (!this.performanceAPI || !this.performanceAPI.getEntriesByType) {\n      return resourcesTime;\n    }\n    const resourcesItems = this.performanceAPI.getEntriesByType('resource');\n    if (!resourcesItems || !(resourcesItems instanceof Array)) {\n      return resourcesTime;\n    }\n    const resourceCounter = {\n      img: { duration: 0, count: 0 },\n      script: { duration: 0, count: 0 },\n      link: { duration: 0, count: 0 }\n    };\n    const resourceMetric = resourcesItems.reduce((counter, current) => {\n      const item = counter[current.initiatorType];\n      if (item) {\n        item.count += 1;\n        item.duration += current.duration;\n      }\n      return counter;\n    }, resourceCounter);\n    resourcesTime.img = Math.round(resourceMetric.img.duration / resourceMetric.img.count);\n    resourcesTime.script = Math.round(resourceMetric.script.duration / resourceMetric.script.count);\n    resourcesTime.link = Math.round(resourceMetric.link.duration / resourceMetric.link.count);\n    return resourcesTime;\n  }\n\n  /**\n   * Compute the time to parse DOM tree.\n   * @return {number}\n   */\n  public computeDOMParsingTime(): number {\n    if (!this.timing) return -1;\n    const DOMParsingTime = Math.round(this.timing.domComplete - this.timing.responseEnd);\n    return DOMParsingTime <= 0 ? -1 : DOMParsingTime;\n  }\n\n  /**\n   * Get DNS Lookup Time by using Timing API.\n   * Note: the time might be 0 due to cache.\n   * @return {number}\n   */\n  public computeDNSLookupTime(): number {\n    if (!this.timing) return -1;\n    const DNSTime = Math.round(this.timing.domainLookupEnd - this.timing.domainLookupStart);\n    return DNSTime <= 0 ? -1 : DNSTime;\n  }\n\n  /**\n   * TTFB Definition.\n   * https://en.wikipedia.org/wiki/Time_To_First_Byte\n   * @return {number}\n   */\n  public computeFirstByteTime(): number {\n    if (!this.timing) return -1;\n    const firstByteTime = Math.round(this.timing.responseStart - this.timing.navigationStart);\n    return firstByteTime <= 0 ? -1 : firstByteTime;\n  }\n}","import { Measurable, BaseMetric } from './BaseMetric';\n\nexport default class ChromeMetric extends BaseMetric implements Measurable {\n  private loadTimes = window['chrome'].loadTimes();\n\n  /**\n   * Override parent's class by using Chrome's loadTimes method.\n   * @override\n   * @return {number}\n   */\n  computeFirstPaintTime(): number {\n    const firstPaintTime = this.loadTimes.firstPaintTime;\n    const startLoadTime = this.loadTimes.startLoadTime;\n    // Somehow we cannot get first paint time,\n    // we need to invoke parent's measuring strategy.\n    if (firstPaintTime <= 0) {\n      return super.computeFirstByteTime();\n    }\n    return Math.round((firstPaintTime - startLoadTime) * 1000);\n  }\n}","import { BaseMetric, Measurable } from './BaseMetric';\n\nexport default class FirefoxMetric extends BaseMetric implements Measurable {}","import { Measurable, BaseMetric } from './BaseMetric';\n\nexport default class OperaMetric extends BaseMetric implements Measurable {}","import { BaseMetric, Measurable, ResourceTime } from './BaseMetric';\n\nexport default class SafariMetric extends BaseMetric implements Measurable {\n  /**\n   * Safari doesn't support getEntriesByType in performance timing API\n   * @override\n   * @return {number}\n   */\n   computeResourceTime(): ResourceTime {\n     try {\n       return super.computeResourceTime();\n     } catch (error) {}\n     return new ResourceTime();\n   }\n}","import { BaseMetric, Measurable } from './BaseMetric';\n\nexport default class MSEdgeMetric extends BaseMetric implements Measurable {}","import { BaseMetric, Measurable } from './BaseMetric';\n\nexport default class MSIEMetric extends BaseMetric implements Measurable {}","export class Reporter {\n  private imageReporter = new Image();\n\n  /**\n   * Report by Image object.\n   * TODO: is there any compatibility issues?\n   * TODO: do we need to handle error case?\n   * @return {Promise<void>}\n   */\n  protected sendRequest(url: string): Promise<void> {\n    this.imageReporter.src = url;\n    return new Promise<void>((resolve, reject) => {\n      const successCallback = () => {\n        resolve();\n        uninstallListeners();\n      };\n      const errorCallback = () => {\n        reject();\n        uninstallListeners();\n      };\n      this.imageReporter.addEventListener('load', successCallback, false);\n      this.imageReporter.addEventListener('error', errorCallback, false);\n\n      const uninstallListeners = () => {\n        this.imageReporter.removeEventListener('load', successCallback, false);\n        this.imageReporter.removeEventListener('error', errorCallback, false);\n      };\n    });\n  }\n\n  protected URLBuilder(endpoint: string, parameters: Object): string {\n    if (!parameters) {\n      throw new Error('Parameters can not be empty');\n    }\n    const timestamp = +new Date();\n    const queries: string[] = [];\n    for (const key of Object.keys(parameters)) {\n      const value = parameters[key];\n      if (value > 0 || value !== '-1') {\n        queries.push(`${key}=${parameters[key]}`);\n      }\n    }\n    const params = queries.join('&');\n    const builtURL = `?${timestamp}&${params}`;\n    return encodeURI(endpoint + builtURL);\n  }\n}","import { Reporter } from './Reporter';\nimport { Metric } from '../metric/BaseMetric';\nimport { Environment } from '../index';\n\nconst parameterMapper = {\n    firstPaintTime: 'fp',\n    firstByteTime: 'fb',\n    firstMeaningfulTime: 'fm',\n    firstInteractionTime: 'fi',\n    totalLoadingTime: 'tl',\n    downloadingTime: 'dl',\n    DOMParsingTime: 'dp',\n    DNSLookupTime: 'du',\n    imagesTime: 'im',\n    stylesTime: 'ss',\n    scriptsTime: 'sc'\n};\n\nexport default class PerformanceReporter extends Reporter {\n    private endpoint: string = `//www.dobest.me:3030/perf.gif`;\n\n    constructor(private token: string, private environment: Environment) {\n        super();\n    }\n\n    report(metric: Metric): Promise<void> {\n        const parameters = this.parameterBuilder(metric);\n        const url = this.URLBuilder(this.endpoint, parameters);\n        LOG('Combined parameters:', parameters);\n        LOG('Report to url:', url);\n        return this.sendRequest(url);\n    }\n\n    private parameterBuilder(metric: Metric) {\n        const parameters = {};\n        const keys = Object.keys(metric);\n        for (const key of keys) {\n            const value = metric[key];\n            const alias = parameterMapper[key];\n            // Filtering invalid metric data\n            if (value && alias && !isNaN(value) && value !== -1) {\n                parameters[alias] = value;\n            }\n        }\n\n        // Should also carry token string\n        parameters['token'] = this.token;\n\n        // Combine environment infomation\n        parameters['os'] = this.environment.operatingSystem._type.toLowerCase();\n        parameters['br'] = this.environment.browser._type.toLowerCase();\n        parameters['bv'] = this.environment.browser.version.toLowerCase();\n        parameters['dc'] = this.environment.device.type;\n        parameters['dv'] = this.environment.device.version;\n\n        return parameters;\n    }\n\n}\n","import ErrorReporter from '../reporter/ErrorReporter';\n\nexport interface Error {\n  message: string;\n  scriptURI: string;\n  line: number;\n  column: number;\n  stack: string;\n}\n\nexport default class ErrorCatcher {\n  private historyErrors: Error[] = [];\n\n  constructor(private reporter: ErrorReporter) {}\n\n  install() {\n    const onerror = window.onerror;\n    window.onerror = (...args) => {\n      // Invoke snapshot\n      onerror && onerror.apply(null, args);\n      const [errorMessage, scriptURI, lineNumber, columnNumber, errorObject] = args;\n      this.packager(<Error>{\n        message: errorMessage,\n        scriptURI: scriptURI,\n        line: lineNumber,\n        column: columnNumber,\n        stack: errorObject.stack\n      });\n    };\n\n    // Surpress error to client console,\n    // report to monitoring service instead.\n    window.addEventListener('error', (event) => {\n      event.preventDefault();\n    });\n  }\n\n  /**\n   * Make error message a packed report-ready object.\n   */\n  packager(error: Error) {\n    const config = (<any>window).WEB_TRACKER.catcher;\n    if (!config.enabled) {\n      return;\n    }\n    const random = !config || config.random < 0 || config.random > 1 ? 1 : config.random;\n    const allowRepeat = config.repeat < 0 ? 5 : config.repeat;\n    const exclude = config.exclude || [];\n\n    // Exclude\n    for (const regex of exclude) {\n      if (regex instanceof RegExp &&\n          regex.test(error.message)\n      ) {\n        LOG('Error is exclued:', error.message);\n        return;\n      }\n    }\n\n    // Error is not selected to report\n    if (Math.random() > random) {\n      LOG('Error is not selected to report');\n      return;\n    }\n\n    // How many times can it repeat?\n    const repeatTimes = this.historyErrors.reduce((sum, historyError) => {\n      return error.message === historyError.message &&\n          error.line === historyError.line &&\n          error.column === historyError.column &&\n          error.stack === historyError.stack\n        ? ++sum : sum;\n    }, 0);\n\n    // Repeat times of the same error exceed\n    if (repeatTimes + 1 > allowRepeat) {\n      LOG('Repeat too many times');\n      return;\n    }\n\n    // Put into history queue\n    this.historyErrors.push(error);\n\n    // Put into reporting queue\n    this.report(error);\n  }\n\n  report(error) {\n    this.reporter.report(error);\n  }\n}","import { Reporter } from './Reporter';\n\nabstract class BufferedReporter<T> extends Reporter {\n  private timerId: number =  0;\n  protected reportQueue: T[] = [];\n\n  bufferReport(content) {\n    const config = (<any>window).WEB_TRACKER.catcher;\n    const merge = config.merge ? config.merge : true;\n    const delay = config.delay < 0 ? 0 : config.delay;\n\n    // Merge content or push content\n    if (!merge) {\n      this.reportQueue.push(content);\n    } else {\n      this._merge(content);\n    }\n\n    // Instant report\n    if (delay <= 0) {\n      this._report();\n      return;\n    } else {\n      if (this.timerId) {\n        return;\n      }\n      // Batch reporting\n      this.timerId = setTimeout(() => {\n        // Start reporting\n        this._report();\n        this.timerId = 0;\n      }, delay);\n    }\n  }\n\n  abstract _merge(..._);\n  abstract _report(..._);\n}\n\nexport default BufferedReporter;","import { Error } from '../error/ErrorCatcher';\nimport { Environment } from '../detector/EnvironmentDetector';\nimport BufferedReporter from './BufferedReporter';\n\nexport default class ErrorReporter extends BufferedReporter<Error> {\n    private endpoint: string = `//www.dobest.me:3030/error.gif`;\n\n    constructor(private token: string, private environment: Environment) { super(); }\n\n    report(error: Error): void {\n        this.bufferReport(error);\n    }\n\n    _report() {\n        LOG('Report Error:', this.reportQueue);\n        const parameters = this.parameterBuilder(this.reportQueue);\n        LOG('Error Parameters:', parameters);\n        const url = this.URLBuilder(this.endpoint, parameters);\n        return this.sendRequest(url);\n    }\n\n    /**\n     * If there are already errors in the queue,\n     * we just ignore this error.\n     */\n    _merge(error: Error) {\n        const found = this.reportQueue.filter(\n            errorInQueue => error.stack === errorInQueue.stack\n        );\n        if (found.length <= 0) {\n            this.reportQueue.push(error);\n        }\n    }\n\n    parameterBuilder(errors: Error[]) {\n        let parameters = {};\n        parameters['err'] = JSON.stringify(errors);\n        // Should also carry token string\n        parameters['token'] = this.token;\n\n        // Combine environment infomation\n        parameters['os'] = this.environment.operatingSystem._type.toLowerCase();\n        parameters['br'] = this.environment.browser._type.toLowerCase();\n        parameters['bv'] = this.environment.browser.version.toLowerCase();\n        parameters['dc'] = this.environment.device.type;\n        parameters['dv'] = this.environment.device.version;\n        return parameters;\n    }\n\n}\n"],"names":["_classCallCheck","instance","Constructor","TypeError","typeOf","type","object","Object","prototype","toString","call","each","factory","i","l","length","detect","name","expression","ua","expr","isFunction","info","version","NA_VERSION","codename","isString","indexOf","isObject","hasOwnProperty","isRegExp","m","exec","replace","init","patterns","detector","detected","NA","pattern","d","checkTW360External","key","external","runpath","twGetRunPath","toLowerCase","security","twGetSecurityID","win","twGetVersion","ex","IEMode","WebRules","re_msie","test","engineMode","engineVersion","browserMode","browserVersion","v_version","split","parseInt","join","v_mode","compatible","WebParse","parse","ieCore","engineName","engine","ve","parseFloat","fullVersion","mode","fullMode","browserName","browser","vb","environment","BrowserType","Chrome","metricStrategy","ChromeMetric","Firefox","FirefoxMetric","Opera","OperaMetric","Safari","SafariMetric","MS_Edge","MSEdgeMetric","MSIE","MSIEMetric","BaseMetric","totalLoadingTime","computeTotalLoadingTime","measure","metricMeasuringStrategy","PerformanceReporter","token","report","catch","reporter","ErrorReporter","ErrorCatcher","install","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","defineProperty","protoProps","staticProps","Detector","rules","this","_rules","value","device","v","os","window","global","DEVICES","re_mediapad","OS","match","ENGINE","BROWSER","x","mxVersion","max_version","LiebaoGetVersion","re_opera_old","userAgent","navigator","appVersion","vendor","Tan","_detector","OSType","EngineType","_type","Environment","detectBrowser","detectEngine","detectOperatingSystem","detectDevice","Browser","Webkit","EdgeHTML","Trident","Blink","Gecko","Presto","AndroidWebkit","UC","Engine","operatingSystem","MacOS","Windows","IOS","Android","ChromeOS","Linux","WindowsPhone","YunOS","OperatingSystem","Device","_super","_this","performanceAPI","performance","timing","__extends","resourcesTime","computeResourceTime","imagesTime","img","stylesTime","link","scriptsTime","script","DNSLookupTime","computeDNSLookupTime","DOMParsingTime","computeDOMParsingTime","firstByteTime","computeFirstByteTime","firstInteractionTime","computeFirstInteractionTime","firstMeaningfulTime","computeFirstMeaningfulTime","firstPaintTime","computeFirstPaintTime","downloadingTime","computeTotalDownloadingTime","Math","round","domLoading","navigationStart","interactionTime","domInteractive","loadingTime","loadEventEnd","pageDownloadingTime","responseEnd","requestStart","ResourceTime","getEntriesByType","resourcesItems","Array","resourceCounter","duration","count","resourceMetric","reduce","counter","current","item","initiatorType","domComplete","DNSTime","domainLookupEnd","domainLookupStart","responseStart","Metric","loadTimes","startLoadTime","error","Image","Reporter","url","imageReporter","src","Promise","resolve","reject","successCallback","uninstallListeners","errorCallback","addEventListener","removeEventListener","endpoint","parameters","Error","timestamp","Date","queries","_a","keys","_i","push","params","builtURL","encodeURI","parameterMapper","metric","parameterBuilder","URLBuilder","sendRequest","keys_1","alias","isNaN","onerror","args","apply","errorMessage","scriptURI","lineNumber","columnNumber","errorObject","packager","message","line","column","stack","event","preventDefault","config","WEB_TRACKER","catcher","enabled","random","allowRepeat","repeat","exclude","exclude_1","regex","RegExp","historyErrors","sum","historyError","BufferedReporter","content","merge","delay","_merge","reportQueue","_report","timerId","setTimeout","bufferReport","filter","errorInQueue","errors","JSON","stringify","_window","installErrorCatcher"],"mappings":"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"}